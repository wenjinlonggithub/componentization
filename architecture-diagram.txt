╔═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╗
║                                    组件化架构解决方案 - 完整架构图                                               ║
╚═══════════════════════════════════════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                          部署层 (Deployment Layer)                                           │
├─────────────────────────────────────────┬───────────────────────────────────────────────────────────────────┤
│              Tenant1-App                │                     Tenant2-App                                    │
│         (Premium Application)           │               (Enterprise Application)                             │
│                                         │                                                                     │
│  ┌─────────────────────────────────────┐│  ┌─────────────────────────────────────────────────────────────┐  │
│  │     Tenant1Application              ││  │             Tenant2Application                             │  │
│  │                                     ││  │                                                             │  │
│  │  • Demo scenarios                   ││  │  • Enterprise demo scenarios                               │  │
│  │  • Configuration: tenant.id=tenant1 ││  │  • Configuration: tenant.id=tenant2                        │  │
│  │  • Port: 8081                       ││  │  • Port: 8082                                               │  │
│  └─────────────────────────────────────┘│  └─────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────┴───────────────────────────────────────────────────────────────────┘
                           │                                           │
                           │ 依赖                                       │ 依赖
                           ▼                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                      定制化层 (Customization Layer)                                         │
├─────────────────────────────────────────┬───────────────────────────────────────────────────────────────────┤
│          Customization-Tenant1          │                   Customization-Tenant2                            │
│         (继承 + 事件混合模式)              │                    (纯事件驱动模式)                                   │
│                                         │                                                                     │
│  ┌─────────────────────────────────────┐│  ┌─────────────────────────────────────────────────────────────┐  │
│  │     CustomOrderProcessor            ││  │        AdvancedOrderEventListener                          │  │
│  │   extends DefaultOrderProcessor     ││  │                                                             │  │
│  │                                     ││  │  • @EventListener BeforeSaveEvent                          │  │
│  │  • beforeSave() - 审核高额订单        ││  │  • @EventListener AfterSaveEvent                           │  │
│  │  • beforeNotify() - SMS通知         ││  │  • @EventListener BeforeNotifyEvent                        │  │
│  └─────────────────────────────────────┘│  │  • 复杂验证 (fraudDetection)                                │  │
│                                         │  │  • ERP集成                                                   │  │
│  ┌─────────────────────────────────────┐│  │  • 高级分析报告                                              │  │
│  │      OrderEventListener             ││  │  • 多渠道通知                                                │  │
│  │                                     ││  └─────────────────────────────────────────────────────────────┘  │
│  │  • @EventListener BeforeSaveEvent  ││                                                                     │
│  │  • @EventListener AfterSaveEvent   ││  ┌─────────────────────────────────────────────────────────────┐  │
│  │  • @EventListener BeforeNotifyEvent││  │              Tenant2Config                                  │  │
│  │  • 库存更新                         ││  │                                                             │  │
│  │  • 阻止默认邮件通知                   ││  │  @ConditionalOnProperty(name="tenant.id",                  │  │
│  └─────────────────────────────────────┘│  │                        havingValue="tenant2")              │  │
│                                         │  └─────────────────────────────────────────────────────────────┘  │
│  ┌─────────────────────────────────────┐│                                                                     │
│  │           Tenant1Config             ││                                                                     │
│  │                                     ││                                                                     │
│  │  @ConditionalOnProperty(            ││                                                                     │
│  │    name="tenant.id",                ││                                                                     │
│  │    havingValue="tenant1")           ││                                                                     │
│  └─────────────────────────────────────┘│                                                                     │
└─────────────────────────────────────────┴───────────────────────────────────────────────────────────────────┘
                           │                                           │
                           │ 依赖                                       │ 依赖
                           ▼                                           ▼
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                        核心层 (Core Layer)                                                  │
│                                      core-system                                                             │
│                                                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┐  │
│  │                                   扩展点接口 (Extension Points)                                        │  │
│  │                                                                                                         │  │
│  │      OrderProcessor (interface)  ←──────────────────────────────────────────────────────────────┐     │  │
│  │      └─ void process(Order order)                                                                 │     │  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────│─────┘  │
│                                                                                                      │        │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────│─────┐  │
│  │                               核心处理器 (Core Processor)                                          │     │  │
│  │                                                                                                   │     │  │
│  │      DefaultOrderProcessor implements OrderProcessor ────────────────────────────────────────────┘     │  │
│  │                                                                                                         │  │
│  │      ┌─ process(Order order):                                                                           │  │
│  │      │   1. validate(order)                                                                            │  │
│  │      │   2. calculatePrice(order)                                                                      │  │
│  │      │   3. 🔄 发布 BeforeSaveEvent ──────────────────────────────────────────────────────────────────┐│  │
│  │      │   4. 🎣 beforeSave(order)    # Hook Method (可被子类覆盖)                                      ││  │
│  │      │   5. save(order)                                                                              ││  │
│  │      │   6. 🔄 发布 AfterSaveEvent ───────────────────────────────────────────────────────────────────┤│  │
│  │      │   7. 🔄 发布 BeforeNotifyEvent ────────────────────────────────────────────────────────────────┤│  │
│  │      │   8. 🎣 beforeNotify(order)  # Hook Method (可被子类覆盖)                                      ││  │
│  │      │   9. notifyUser(order) [条件执行]                                                             ││  │
│  │      └─                                                                                              ││  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│                                                                                                         ││  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│  │                                    事件系统 (Event System)                                            ││  │
│  │                                                                                                      ││  │
│  │    BeforeSaveEvent  ─────────────────────────────────────────────────────────────────────────────────┘│  │
│  │    │                                                                                                  │  │
│  │    ├─ Order order                                                                                     │  │
│  │    └─ boolean skipDefaultAction                                                                       │  │
│  │                                                                                                       │  │
│  │    AfterSaveEvent                                                                                     │  │
│  │    │                                                                                                  │  │
│  │    └─ Order order                                                                                     │  │
│  │                                                                                                       │  │
│  │    BeforeNotifyEvent ──────────────────────────────────────────────────────────────────────────────────┐│
│  │    │                                                                                                  ││  │
│  │    ├─ Order order                                                                                     ││  │
│  │    └─ boolean skipDefaultAction                                                                       ││  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│                                                                                                         ││  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│  │                                   领域模型 (Domain Models)                                            ││  │
│  │                                                                                                      ││  │
│  │    Order                              User                                                           ││  │
│  │    │                                  │                                                              ││  │
│  │    ├─ String id                       ├─ String id                                                   ││  │
│  │    ├─ String userId                   ├─ String name                                                 ││  │
│  │    ├─ BigDecimal amount              ├─ String email                                                ││  │
│  │    ├─ String status                   └─ String phone                                                ││  │
│  │    ├─ LocalDateTime createdAt                                                                        ││  │
│  │    └─ User user                                                                                      ││  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│                                                                                                         ││  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│  │                                   核心服务 (Core Services)                                            ││  │
│  │                                                                                                      ││  │
│  │    NotificationService                                                                               ││  │
│  │    │                                                                                                 ││  │
│  │    ├─ sendEmail(String to, String message)                                                          ││  │
│  │    └─ sendSms(String phone, String message)                                                         ││  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│                                                                                                         ││  │
│  ┌─────────────────────────────────────────────────────────────────────────────────────────────────────┤│  │
│  │                                   配置管理 (Configuration)                                            ││  │
│  │                                                                                                      ││  │
│  │    CoreSystemConfig                                                                                  ││  │
│  │    │                                                                                                 ││  │
│  │    └─ @Bean @ConditionalOnMissingBean(OrderProcessor.class)                                         ││  │
│  │       OrderProcessor defaultOrderProcessor()                                                        ││  │
│  └─────────────────────────────────────────────────────────────────────────────────────────────────────┘│  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────┘  │
                                                                                                              │
══════════════════════════════════════════════════════════════════════════════════════════════════════════════

                                          🔄 事件流向图 (Event Flow)

                                     DefaultOrderProcessor.process()
                                              │
                  ┌─────────────────────────────────────────────────────────────────┐
                  │                                                                 │
                  ▼                                                                 ▼
         ┌─────────────────┐                                            ┌─────────────────┐
         │ BeforeSaveEvent │                                            │BeforeNotifyEvent│
         └─────────────────┘                                            └─────────────────┘
                  │                                                                 │
         ┌────────┴────────┐                                              ┌────────┴────────┐
         │                 │                                              │                 │
         ▼                 ▼                                              ▼                 ▼
    ┌─────────┐    ┌─────────────────┐                           ┌─────────────┐   ┌─────────────────┐
    │租户1    │    │     租户2       │                           │   租户1     │   │     租户2       │
    │事件     │    │事件监听器       │                           │事件         │   │事件监听器       │
    │监听器   │    │                 │                           │监听器       │   │                 │
    │         │    │• 复杂验证       │                           │             │   │• 多渠道通知     │
    │• 保存   │    │• 欺诈检测       │                           │• 跳过       │   │• 高级处理       │
    │  前     │    │                 │                           │  默认       │   │                 │
    │  逻辑   │    │                 │                           │  邮件       │   │                 │
    └─────────┘    └─────────────────┘                           └─────────────┘   └─────────────────┘
                                                                          │
                               AfterSaveEvent                             │
                                      │                                   │
                           ┌──────────┴──────────┐                       │
                           │                     │                       │
                           ▼                     ▼                       │
                    ┌─────────────┐    ┌─────────────────┐               │
                    │   租户1     │    │     租户2       │               │
                    │事件         │    │事件监听器       │               │
                    │监听器       │    │                 │               │
                    │             │    │• ERP集成        │               │
                    │• 更新       │    │• 高级           │               │
                    │  库存       │    │  分析           │               │
                    └─────────────┘    └─────────────────┘               │
                                                                         │
                                                            ┌────────────▼───────────────┐
                                                            │    条件执行                   │
                                                            │  if (!event.skipDefault)   │
                                                            │      notifyUser(order)     │
                                                            └────────────────────────────┘

══════════════════════════════════════════════════════════════════════════════════════════════════════════════

                                     🎯 扩展模式对比 (Extension Patterns Comparison)

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                    租户1 - 混合模式 (Hybrid Pattern)                                        │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│  继承模式 (Inheritance)                    +                    事件模式 (Event-Driven)                     │
│                                           │                                                                 │
│  CustomOrderProcessor                     │                    OrderEventListener                          │
│  extends DefaultOrderProcessor            │                                                                │
│                                           │                    @EventListener                              │
│  ✅ 直接覆盖钩子方法                        │                    ✅ 松耦合                                     │
│  ✅ 简单直观                               │                    ✅ 可插拔                                     │
│  ❌ 强耦合                                │                    ✅ 多监听器支持                               │
│  ❌ 单继承限制                             │                    ❌ 需要额外事件设计                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                   租户2 - 纯事件模式 (Pure Event-Driven)                                   │
├─────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                                             │
│  AdvancedOrderEventListener                                                                                 │
│                                                                                                             │
│  @EventListener BeforeSaveEvent    ──────────────────────────────────────────────────────────────────────┐  │
│  @EventListener AfterSaveEvent     ──────────────────────────────────────────────────────────────────────┤  │
│  @EventListener BeforeNotifyEvent  ──────────────────────────────────────────────────────────────────────┤  │
│                                                                                                          │  │
│  ✅ 完全解耦                                                                                               │  │
│  ✅ 不需要继承                                                                                             │  │
│  ✅ 支持复杂业务逻辑                                                                                         │  │
│  ✅ 易于测试和维护                                                                                          │  │
│  ✅ 支持条件跳过默认行为                                                                                     │  │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────┘

══════════════════════════════════════════════════════════════════════════════════════════════════════════════